
<h2>Admin Panel (PIN Protected)</h2>
<div id="admin-login">
  <label>Enter PIN: <input type="password" id="admin-pin" /></label>
  <button class="btn" onclick="checkPin()">Login</button>
</div>

<div id="admin-dashboard" style="display:none;">
  <section>
    <h3>Manual LASH3ZBux Add</h3>
    <form id="manual-bux-form">
      <label>Username: <input type="text" name="username" required /></label>
      <label>Amount of Bux: <input type="number" name="bux" required /></label>
      <button type="button" class="btn" onclick="addManualBux()">Add Bux</button>
    </form>
    <p id="bux-status"></p>
  </section>

  <section>
    <h3>Toggle Prediction Forms</h3>
    <label><input type="checkbox" id="bonus-toggle" checked> Bonus Hunt Predictions</label><br>
    <label><input type="checkbox" id="tournament-toggle" checked> Tournament Predictions</label><br>
    <label><input type="checkbox" id="player-toggle" checked> Player Hunt Predictions</label><br>
    <button class="btn-secondary" onclick="saveToggles()">Save Toggles</button>
    <p id="toggle-status"></p>
  </section>

  <section>
    <h3>Tip Tracker</h3>
    <form id="tip-form">
      <label>Username: <input type="text" name="username" required /></label>
      <label>Amount ($): <input type="number" step="0.01" name="amount" required /></label>
      <label>Status:
        <select name="status">
          <option value="Pending">Pending</option>
          <option value="Paid">Paid</option>
        </select>
      </label>
      <button type="button" class="btn" onclick="submitTip()">Save Tip</button>
    </form>
    <p id="tip-status"></p>
  </section>

  <section>
    <h3>Reset Tools</h3>
    <button class="btn-warn" onclick="resetMonthly()">Reset Month (Hunts/Tournaments/Lucky 7)</button>
    <button class="btn-danger" onclick="resetAll()">Reset EVERYTHING</button>
    <p id="reset-status"></p>
  </section>
</div>

<script>
const ADMIN_PIN = '2323';

function checkPin() {
  const enteredPin = document.getElementById('admin-pin').value;
  if (enteredPin === ADMIN_PIN) {
    document.getElementById('admin-login').style.display = 'none';
    document.getElementById('admin-dashboard').style.display = 'block';
  } else {
    alert('Incorrect PIN!');
  }
}


async function addManualBux() {
  const username = document.querySelector('#manual-bux-form [name="username"]').value.trim();
  const bux = document.querySelector('#manual-bux-form [name="bux"]').value.trim();
  if (!username || !bux || isNaN(bux)) {
    alert('Please enter a valid username and bux amount.');
    return;
  }
  if (!confirm('Are you sure you want to add ' + bux + ' LASH3ZBux to ' + username + '?')) return;
    
  if (!window.LASH3Z_CONFIG.apps_script_exec) {
    document.getElementById('bux-status').textContent = 'Configured for manual sheet edit (no live write)';
    return;
  }
  const username = document.querySelector('#manual-bux-form [name="username"]').value;
  const bux = document.querySelector('#manual-bux-form [name="bux"]').value;
  try {
    const response = await fetch(window.LASH3Z_CONFIG.apps_script_exec, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ action: 'add_bux', user: username, bux: bux })
    });
    const result = await response.text();
    
    document.getElementById('bux-status').textContent = 'Response: ' + result;
    console.log('[ADMIN WRITE]', { user: username, bux: bux, result: result });
    
  } catch (e) {
    document.getElementById('bux-status').textContent = 'Error: ' + e.message;
  }
}

async function saveToggles() {
  const bonus = document.getElementById('bonus-toggle').checked;
  const tour = document.getElementById('tournament-toggle').checked;
  const player = document.getElementById('player-toggle').checked;
  if (!window.LASH3Z_CONFIG.apps_script_exec) {
    document.getElementById('toggle-status').textContent = 'Stored locally (no live write)';
    return;
  }
  try {
    const response = await fetch(window.LASH3Z_CONFIG.apps_script_exec, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        action: 'save_toggles',
        bonus: bonus, tournament: tour, player: player
      })
    });
    const result = await response.text();
    document.getElementById('toggle-status').textContent = 'Response: ' + result;
  } catch (e) {
    document.getElementById('toggle-status').textContent = 'Error: ' + e.message;
  }
}

async function submitTip() {
  const username = document.querySelector('#tip-form [name="username"]').value;
  const amount = document.querySelector('#tip-form [name="amount"]').value;
  const status = document.querySelector('#tip-form [name="status"]').value;
  if (!window.LASH3Z_CONFIG.apps_script_exec) {
    document.getElementById('tip-status').textContent = 'Configured for manual sheet edit (no live write)';
    return;
  }
  try {
    const response = await fetch(window.LASH3Z_CONFIG.apps_script_exec, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ action: 'tip', user: username, amount, status })
    });
    const result = await response.text();
    document.getElementById('tip-status').textContent = 'Response: ' + result;
  } catch (e) {
    document.getElementById('tip-status').textContent = 'Error: ' + e.message;
  }
}

async function resetMonthly() {
  if (!window.LASH3Z_CONFIG.apps_script_exec) {
    document.getElementById('reset-status').textContent = 'Please clear the master sheet ranges manually';
    return;
  }
  try {
    const response = await fetch(window.LASH3Z_CONFIG.apps_script_exec, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ action: 'reset_monthly' })
    });
    const result = await response.text();
    document.getElementById('reset-status').textContent = 'Response: ' + result;
  } catch (e) {
    document.getElementById('reset-status').textContent = 'Error: ' + e.message;
  }
}
async function resetAll() {
  if (!window.LASH3Z_CONFIG.apps_script_exec) {
    document.getElementById('reset-status').textContent = 'Please clear all sheets manually';
    return;
  }
  try {
    const response = await fetch(window.LASH3Z_CONFIG.apps_script_exec, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ action: 'reset_all' })
    });
    const result = await response.text();
    document.getElementById('reset-status').textContent = 'Response: ' + result;
  } catch (e) {
    document.getElementById('reset-status').textContent = 'Error: ' + e.message;
  }
}
</script>

<script>
function logDebug(message) {
    console.log('[DEBUG]', message);
}
window.addEventListener('load', () => {
    logDebug('Admin Panel and Leaderboard Loaded.');
});
</script>
