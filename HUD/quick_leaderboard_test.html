<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LASH3Z HUD - Leaderboard Test v5</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1 class="title">Leaderboard Quick Test v5</h1>
  <div class="leaderboard-controls">
    <input type="text" id="leaderboard-search" placeholder="Search username..." onkeyup="filterLeaderboard()">
    <button onclick="sortLeaderboard()">Sort by Points</button>
    <button onclick="exportLeaderboardCSV()">Download CSV</button>
    <label><input type="checkbox" id="show-all-toggle" onchange="toggleShowAll()"> Show All</label>
  </div>
  <div id="leaderboard-container" class="leaderboard"></div>
  <div class="leaderboard-pagination">
    <button onclick="prevPage()">Prev</button>
    <span id="page-info">Page 1</span>
    <button onclick="nextPage()">Next</button>
  </div>

  <script>
    const rowsPerPage = 5;
    let currentPage = 1;
    let showAll = false;

    fetch('leaderboard.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('leaderboard-container').innerHTML = html;
        paginateLeaderboard();
      })
      .catch(err => console.error('Failed to load leaderboard module:', err));

    function filterLeaderboard() {
      const input = document.getElementById('leaderboard-search').value.toLowerCase();
      const rows = document.querySelectorAll('#leaderboard-body tr');
      rows.forEach(row => {
        const username = row.querySelector('td:first-child').innerText.toLowerCase();
        row.style.display = username.includes(input) ? '' : 'none';
      });
      paginateLeaderboard();
    }

    function sortLeaderboard() {
      const tbody = document.getElementById('leaderboard-body');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      rows.sort((a, b) => parseInt(b.cells[1].innerText) - parseInt(a.cells[1].innerText));
      tbody.innerHTML = '';
      rows.forEach(row => tbody.appendChild(row));
      paginateLeaderboard();
    }

    function exportLeaderboardCSV() {
      const rows = document.querySelectorAll('#leaderboard-body tr');
      let csvContent = "data:text/csv;charset=utf-8,Username,Points\n";
      rows.forEach(row => {
        const cols = row.querySelectorAll('td');
        const username = cols[0]?.innerText || '';
        const points = cols[1]?.innerText || '';
        if (row.style.display !== 'none') {
          csvContent += `${username},${points}\n`;
        }
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'leaderboard.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function toggleShowAll() {
      showAll = document.getElementById('show-all-toggle').checked;
      paginateLeaderboard();
    }

    function paginateLeaderboard() {
      const rows = document.querySelectorAll('#leaderboard-body tr');
      const totalPages = Math.ceil(rows.length / rowsPerPage);
      rows.forEach((row, index) => {
        row.style.display = (showAll || (index >= (currentPage - 1) * rowsPerPage && index < currentPage * rowsPerPage)) ? '' : 'none';
      });
      document.getElementById('page-info').innerText = showAll ? 'All Players' : `Page ${currentPage} of ${totalPages}`;
    }

    function nextPage() {
      if (showAll) return;
      const rows = document.querySelectorAll('#leaderboard-body tr');
      const totalPages = Math.ceil(rows.length / rowsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        paginateLeaderboard();
      }
    }

    function prevPage() {
      if (showAll) return;
      if (currentPage > 1) {
        currentPage--;
        paginateLeaderboard();
      }
    }
  </script>
</body>
</html>
