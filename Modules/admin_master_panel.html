<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Master Panel</title>
  <link rel="stylesheet" href="../HUD/style.css">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: #0a0a0a;
      color: #0ff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 10px #0ff;
    }
    .admin-section {
      background: #111;
      padding: 20px;
      border: 1px solid #0ff;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px #0ff, inset 0 0 10px #0cc;
    }
    label {
      display: block;
      margin-top: 10px;
      font-size: 1rem;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #0ff;
      background: #000;
      color: #0ff;
      border-radius: 5px;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      background: #0ff;
      color: #000;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #0cc;
      box-shadow: 0 0 10px #0ff, 0 0 20px #0cc;
    }
    .log-box {
      margin-top: 10px;
      background: #000;
      padding: 10px;
      border: 1px solid #0ff;
      height: 100px;
      overflow-y: auto;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <div class="admin-section" id="leaderboard-preview">
    <h2>Leaderboard Preview (Top 3)</h2>
    <table style="width:100%; border-collapse: collapse; text-align: center; background: #000; color: #0ff;">
      <thead>
        <tr style="background:#111;">
          <th>Rank</th><th>Player</th><th>Total Bux</th>
        </tr>
      </thead>
      <tbody id="top3-rows"></tbody>
    </table>
    <canvas id="buxChart" style="margin-top: 20px; background: #111; border:1px solid #0ff; border-radius:5px;"></canvas>
  </div>
    
  <h1>Admin Master Panel</h1>

  <div class="admin-section" id="admin-summary">
    <h2>Admin Summary</h2>
    <p id="summary-total-players">Total Players: 0</p>
    <p id="summary-total-bux">Total Bux: 0</p>
    <p id="summary-total-payouts">Total Payouts: 0</p>
  </div>
    

  <!-- Section: LASH3ZBux Management -->
  <div class="admin-section">
    <h2>LASH3ZBux Management</h2>
    <label for="username">Username:</label>
    <input type="text" id="username" placeholder="Enter username" />

    <label for="buxAmount">Add Bux:</label>
    <input type="number" id="buxAmount" placeholder="Amount" />

    <button onclick="addBux()">Add LASH3ZBux</button>
    <div class="log-box" id="bux-log"></div>
  </div>

  <!-- Section: Prediction Form Toggles -->
  <div class="admin-section">
    <h2>Prediction Forms</h2>
    <label><input type="checkbox" id="toggleMega" /> Enable Mega Hunt Predictions</label>
    <label><input type="checkbox" id="toggleSuper" /> Enable Super Hunt Predictions</label>
    <label><input type="checkbox" id="togglePlayer" /> Enable Player Hunt Predictions</label>
    <button onclick="savePredictionToggles()">Save Toggles</button>
    <div class="log-box" id="prediction-log"></div>
  </div>

  <!-- Section: Payout Records -->
  <div class="admin-section">
    <h2>Payout Records</h2>
    <label for="payoutUser">Username:</label>
    <input type="text" id="payoutUser" placeholder="Enter username" />

    <label for="payoutAmount">Payout Amount:</label>
    <input type="number" id="payoutAmount" placeholder="Amount" />

    <button onclick="recordPayout()">Record Payout</button>
    <div class="log-box" id="payout-log"></div>
  </div>

  <script>
    // Add LASH3ZBux
    function addBux() {
      const username = document.getElementById('username').value.trim();
      const amount = parseInt(document.getElementById('buxAmount').value);
      if (!username || isNaN(amount) || amount <= 0) {
        alert('Enter a valid username and amount.');
        return;
      }
      let leaderboard = JSON.parse(localStorage.getItem('unifiedLeaderboard')) || [];
      let user = leaderboard.find(p => p.username === username);
      if (!user) {
        user = { username, hunts: 0, tournaments: 0, lucky7: 0, total: 0 };
        leaderboard.push(user);
      }
      user.total += amount;
      localStorage.setItem('unifiedLeaderboard', JSON.stringify(leaderboard));
      logMessage('bux-log', `Added ${amount} Bux to ${username}.`);
    }

    // Save prediction toggles
    function savePredictionToggles() {
      const toggles = {
        mega: document.getElementById('toggleMega').checked,
        super: document.getElementById('toggleSuper').checked,
        player: document.getElementById('togglePlayer').checked
      };
      localStorage.setItem('predictionToggles', JSON.stringify(toggles));
      logMessage('prediction-log', 'Prediction toggles saved.');
    }

    // Record payout
    function recordPayout() {
      const username = document.getElementById('payoutUser').value.trim();
      const amount = parseInt(document.getElementById('payoutAmount').value);
      if (!username || isNaN(amount) || amount <= 0) {
        alert('Enter a valid username and payout amount.');
        return;
      }
      const payoutRecords = JSON.parse(localStorage.getItem('payoutRecords')) || [];
      payoutRecords.push({ username, amount, date: new Date().toLocaleString() });
      localStorage.setItem('payoutRecords', JSON.stringify(payoutRecords));
      logMessage('payout-log', `Recorded payout of ${amount} to ${username}.`);
    }

    // Utility: log message
    function logMessage(elementId, message) {
      const log = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString();
      log.innerHTML += `[${timestamp}] ${message}<br>`;
      log.scrollTop = log.scrollHeight;
    }
  
    function updateAdminSummary() {
      const leaderboard = JSON.parse(localStorage.getItem('unifiedLeaderboard')) || [];
      const totalPlayers = leaderboard.length;
      const totalBux = leaderboard.reduce((sum, p) => sum + (p.total || 0), 0);

      const payouts = JSON.parse(localStorage.getItem('payoutRecords')) || [];
      const totalPayouts = payouts.reduce((sum, p) => sum + (p.amount || 0), 0);

      document.getElementById('summary-total-players').innerText = 'Total Players: ' + totalPlayers;
      document.getElementById('summary-total-bux').innerText = 'Total Bux: ' + totalBux;
      document.getElementById('summary-total-payouts').innerText = 'Total Payouts: ' + totalPayouts;
    }

    function syncLeaderboard() {
      window.dispatchEvent(new Event('storage'));
      updateAdminSummary();
    }

    // Override addBux and recordPayout to call syncLeaderboard
    const oldAddBux = addBux;
    addBux = function() {
      oldAddBux();
      syncLeaderboard();
    };

    const oldRecordPayout = recordPayout;
    recordPayout = function() {
      oldRecordPayout();
      syncLeaderboard();
    };

    document.addEventListener('DOMContentLoaded', updateAdminSummary);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    function updateLeaderboardPreview() {
      const leaderboard = JSON.parse(localStorage.getItem('unifiedLeaderboard')) || [];
      leaderboard.sort((a, b) => (b.total || 0) - (a.total || 0));
      const top3 = leaderboard.slice(0, 3);
      const rows = top3.map((p, i) => `<tr><td>${i+1}</td><td>${p.username}</td><td>${p.total}</td></tr>`).join('');
      document.getElementById('top3-rows').innerHTML = rows;

      renderBuxChart(leaderboard.slice(0, 5)); // Chart for top 5 players
    }

    function renderBuxChart(players) {
      const ctx = document.getElementById('buxChart').getContext('2d');
      if (window.buxChartInstance) {
        window.buxChartInstance.destroy();
      }
      window.buxChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: players.map(p => p.username),
          datasets: [{
            label: 'Total Bux',
            data: players.map(p => p.total),
            backgroundColor: 'rgba(0, 255, 255, 0.7)',
            borderColor: '#0ff',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: '#0ff' },
              grid: { color: '#222' }
            },
            x: {
              ticks: { color: '#0ff' },
              grid: { color: '#222' }
            }
          },
          plugins: {
            legend: { labels: { color: '#0ff' } }
          }
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateLeaderboardPreview();
    });
    </script>
    </body>
    
</html>
