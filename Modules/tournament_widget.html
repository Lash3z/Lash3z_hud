<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Round Tournament Widget</title>
  <link rel="stylesheet" href="../HUD/style.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');
    body { font-family: 'Orbitron', sans-serif; background: radial-gradient(circle, #000 0%, #0a0a0a 100%); }
    h1, h2, h3 { text-shadow: 0 0 10px #0ff, 0 0 20px #0ff; }
    .widget, .match {
      background: #111;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 15px #0ff, inset 0 0 10px #0cc;
      border: 1px solid #0ff;
      text-align: center;
    }
    input {
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      box-shadow: inset 0 0 5px #0cc;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
    }
    button {
      background: #0ff;
      color: #000;
      font-weight: bold;
      text-transform: uppercase;
      box-shadow: 0 0 10px #0ff;
      transition: 0.2s;
    }
    button:hover {
      background: #0cc;
      box-shadow: 0 0 20px #0ff, 0 0 30px #0cc;
    }
    .stats, .match-result {
      margin-top: 15px;
      background: #000;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #0ff;
      box-shadow: inset 0 0 10px #0cc;
      text-shadow: 0 0 5px #0ff;
    }

    body { background: #0f0f0f; color: #0ff; font-family: Arial, sans-serif; padding: 20px; text-align: center; }
    h1 { color: #0ff; }
    .tournament { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; justify-items: center; }
    .match { background: #111; padding: 15px; border-radius: 8px; width: 280px; text-align: left; }
    label { display: block; margin-top: 5px; }
    input { width: 100%; padding: 6px; margin-top: 5px; border-radius: 5px; border: none; }
    button { margin-top: 8px; padding: 8px 10px; background: #0ff; color: #000; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0cc; }
    .match-result { margin-top: 5px; }
    .winner { color: #0f0; font-weight: bold; }
    .round-title { grid-column: span 2; margin-top: 20px; font-size: 1.2rem; text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Multi-Round Tournament Widget</h1>

  <div class="tournament" id="tournament-grid">
    <div class="round-title">Round 1</div>
    <div class="match">
      <h3>Match 1</h3>
      <label for="p1a">Player A:</label><input type="text" id="p1a">
      <label for="p1b">Player B:</label><input type="text" id="p1b">
      <label for="s1a">Score A:</label><input type="number" id="s1a">
      <label for="s1b">Score B:</label><input type="number" id="s1b">
      <button onclick="determineWinner('1')">Set Winner</button>
      <div class="match-result" id="r1"></div>
    </div>
    <div class="match">
      <h3>Match 2</h3>
      <label for="p2a">Player A:</label><input type="text" id="p2a">
      <label for="p2b">Player B:</label><input type="text" id="p2b">
      <label for="s2a">Score A:</label><input type="number" id="s2a">
      <label for="s2b">Score B:</label><input type="number" id="s2b">
      <button onclick="determineWinner('2')">Set Winner</button>
      <div class="match-result" id="r2"></div>
    </div>
    
    <div class="round-title">Semi-Final</div>
    <div class="match" style="grid-column: span 2;">
      <h3>Semi-Final: Winner Match 1 vs Winner Match 2</h3>
      <p id="sf-players"></p>
      <label for="sfa">Score A:</label><input type="number" id="sfa">
      <label for="sfb">Score B:</label><input type="number" id="sfb">
      <button onclick="determineSemiFinal()">Set Semi-Final Winner</button>
      <div class="match-result" id="sf-result"></div>
    </div>
    
    <div class="round-title">Final</div>
    <div class="match" style="grid-column: span 2;">
      <h3>Final</h3>
      <p id="final-players"></p>
      <label for="fa">Score A:</label><input type="number" id="fa">
      <label for="fb">Score B:</label><input type="number" id="fb">
      <button onclick="determineFinal()">Set Champion</button>
      <div class="match-result" id="final-result"></div>
    </div>
  </div>

  <script>
    let winners = { m1: '', m2: '', semi: '' };

    function determineWinner(match) {
      const pa = document.getElementById(`p${match}a`).value.trim();
      const pb = document.getElementById(`p${match}b`).value.trim();
      const sa = parseFloat(document.getElementById(`s${match}a`).value) || 0;
      const sb = parseFloat(document.getElementById(`s${match}b`).value) || 0;
      const resultDiv = document.getElementById(`r${match}`);

      if (!pa || !pb) {
        resultDiv.innerHTML = 'Enter both players.';
        return;
      }

      let winner = sa > sb ? pa : (sb > sa ? pb : 'Tie');
      resultDiv.innerHTML = winner === 'Tie' ? "It's a tie!" : `üèÜ Winner: <span class='winner'>${winner}</span>`;
      winners[`m${match}`] = winner !== 'Tie' ? winner : '';

      // Save to localStorage
      localStorage.setItem('multiRoundTournament', JSON.stringify(winners));
      updateSemiFinal();
    }

    function updateSemiFinal() {
      document.getElementById('sf-players').innerText = winners.m1 && winners.m2 ? `${winners.m1} vs ${winners.m2}` : 'Waiting for winners...';
    }

    function determineSemiFinal() {
      const sa = parseFloat(document.getElementById('sfa').value) || 0;
      const sb = parseFloat(document.getElementById('sfb').value) || 0;
      const resultDiv = document.getElementById('sf-result');
      if (!winners.m1 || !winners.m2) {
        resultDiv.innerText = 'Complete Round 1 first.';
        return;
      }
      let winner = sa > sb ? winners.m1 : (sb > sa ? winners.m2 : 'Tie');
      resultDiv.innerHTML = winner === 'Tie' ? "It's a tie!" : `üèÜ Winner: <span class='winner'>${winner}</span>`;
      winners.semi = winner !== 'Tie' ? winner : '';
      localStorage.setItem('multiRoundTournament', JSON.stringify(winners));
      updateFinal();
    }

    function updateFinal() {
      document.getElementById('final-players').innerText = winners.semi ? `${winners.semi} vs TBD` : 'Waiting for semi-final winner...';
    }

    function determineFinal() {
      const fa = parseFloat(document.getElementById('fa').value) || 0;
      const fb = parseFloat(document.getElementById('fb').value) || 0;
      const resultDiv = document.getElementById('final-result');
      if (!winners.semi) {
        resultDiv.innerText = 'Complete semi-final first.';
        return;
      }
      let champion = fa > fb ? winners.semi : (fb > fa ? 'Opponent' : 'Tie');
      resultDiv.innerHTML = champion === 'Tie' ? "It's a tie!" : `üèÜ Champion: <span class='winner'>${champion}</span>`;
      localStorage.setItem('multiRoundTournament', JSON.stringify(winners));
    }

    window.onload = () => {
      const saved = JSON.parse(localStorage.getItem('multiRoundTournament'));
      if (saved) {
        winners = saved;
        updateSemiFinal();
        updateFinal();
      }
    };
  
    function awardChampionPoints(champion) {
      if (!champion || champion === 'Tie') return;
      const leaderboard = JSON.parse(localStorage.getItem('unifiedLeaderboard')) || [];
      let player = leaderboard.find(p => p.username === champion);
      if (player) {
        player.tournaments = (player.tournaments || 0) + 20;
        player.total = (player.hunts || 0) + (player.tournaments || 0) + (player.lucky7 || 0);
      } else {
        leaderboard.push({ username: champion, hunts: 0, tournaments: 20, lucky7: 0, total: 20 });
      }
      localStorage.setItem('unifiedLeaderboard', JSON.stringify(leaderboard));
      alert(`Champion ${champion} has been awarded +20 LASH3ZBux!`);
    }

    // Update determineFinal to call awardChampionPoints
    const oldDetermineFinal = determineFinal;
    determineFinal = function() {
      const fa = parseFloat(document.getElementById('fa').value) || 0;
      const fb = parseFloat(document.getElementById('fb').value) || 0;
      const resultDiv = document.getElementById('final-result');
      if (!winners.semi) {
        resultDiv.innerText = 'Complete semi-final first.';
        return;
      }
      let champion = fa > fb ? winners.semi : (fb > fa ? 'Opponent' : 'Tie');
      resultDiv.innerHTML = champion === 'Tie' ? "It's a tie!" : `üèÜ Champion: <span class='winner'>${champion}</span>`;
      winners.champion = champion;
      localStorage.setItem('multiRoundTournament', JSON.stringify(winners));
      awardChampionPoints(champion);
    };
</script>
</body>
</html>
